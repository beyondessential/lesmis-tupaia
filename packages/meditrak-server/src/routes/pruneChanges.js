/**
 * Tupaia MediTrak
 * Copyright (c) 2017 Beyond Essential Systems Pty Ltd
 */

import { respond } from '@tupaia/utils';

/**
 * Legacy endpoint that is no longer required
 * TODO get rid of this file when no one is hitting it any more
 */
export async function pruneChanges(req, res) {
  const { database } = req;
  const { pool } = database;
  // warm up pool so it has made the initial connection
  await pool.query('SELECT * FROM user_account LIMIT 10;');
  const s = Date.now();
  const r = await pool.query(`
    SELECT
      survey_response.id as "surveyResponseId",
      survey_response.submission_time as "date",
      entity.code as "entityCode",
      entity.name as "entityName",
      question.code as "dataElementCode",
      question.type as "type",
      answer.text as "value"
    FROM
      survey_response
    JOIN
      answer ON answer.survey_response_id = survey_response.id
    JOIN
      entity ON entity.id = survey_response.entity_id
    JOIN
      question ON question.id = answer.question_id
    JOIN
      survey ON survey.id = survey_response.survey_id
    WHERE
      question_id IN ('5ebde7ec61f76a6fd0028eaf')
    AND
      entity.id IN ('5e82eed761f76a2743000501','5e82eed461f76a2743000230','5e82eed461f76a274300029f','5e82eed561f76a274300038a','5e82eed561f76a274300038c','5e82eed561f76a274300038e','5e82eed561f76a274300039a','5e82eed561f76a274300039c','5e82eed661f76a2743000472','5e82eed461f76a2743000232','5e82eed461f76a2743000234','5e82eed461f76a274300025c','5e82eed461f76a274300023a','5e82eed561f76a2743000388','5e82eed461f76a2743000236','5e82eed461f76a2743000238','5e82eed461f76a2743000240','5e82eed461f76a274300025a','5e82eed461f76a2743000258','5e82eed461f76a274300023c','5e82eed461f76a274300023e','5e82eed461f76a2743000242','5e82eed461f76a2743000244','5e82eed461f76a2743000246','5e82eed561f76a2743000396','5e82eed461f76a2743000248','5e82eed461f76a274300024c','5e82eed461f76a274300025e','5e82eed461f76a2743000272','5e82eed461f76a274300024e','5e82eed461f76a2743000250','5e82eed461f76a2743000252','5e82eed461f76a2743000254','5e82eed461f76a2743000256','5e82eed461f76a2743000260','5e82eed461f76a2743000262','5e82eed561f76a274300032f','5e82eed461f76a274300026e','5e82eed461f76a2743000274','5e82eed461f76a2743000264','5e82eed461f76a2743000266','5e82eed461f76a2743000270','5e82eed461f76a2743000268','5e82eed461f76a274300026c','5e82eed461f76a274300026a','5e82eed461f76a2743000276','5e82eed461f76a2743000278','5e82eed461f76a274300027a','5e82eed461f76a274300027c','5e82eed461f76a274300027e','5e82eed461f76a2743000280','5e82eed461f76a2743000282','5e82eed461f76a2743000284','5e82eed461f76a2743000286','5e82eed461f76a274300029b','5e82eed461f76a2743000288','5e82eed461f76a274300028a','5e82eed461f76a274300028d','5e82eed461f76a27430002a7','5e82eed461f76a27430002a9','5ed4840961f76a744b0527de','5e82eed461f76a2743000291','5e82eed461f76a2743000293','5e82eed461f76a2743000295','5e82eed461f76a2743000297','5e82eed461f76a274300029d','5e82eed461f76a2743000299','5e82eed461f76a27430002a1','5e82eed461f76a27430002bf','5e82eed461f76a27430002a3','5e82eed461f76a27430002a5','5e82eed461f76a27430002ab','5e82eed461f76a27430002ad','5e82eed561f76a27430002f5','5e82eed461f76a27430002af','5e82eed461f76a27430002b1','5e82eed461f76a27430002b3','5e82eed461f76a27430002b5','5e82eed461f76a27430002b7','5e82eed461f76a27430002b9','5e82eed461f76a27430002cf','5e82eed561f76a274300030b','5e82eed461f76a27430002bb','5e82eed461f76a27430002bd','5e82eed461f76a27430002c1','5e82eed561f76a2743000307','5e82eed461f76a27430002c3','5e82eed461f76a27430002c5','5e82eed461f76a27430002c7','5e82eed561f76a2743000398','5e82eed461f76a27430002c9','5e82eed461f76a27430002cb','5e82eed461f76a27430002cd','5e82eed461f76a27430002d1','5e82eed461f76a27430002d3','5e82eed461f76a27430002d5','5e82eed461f76a27430002d7','5e82eed461f76a27430002d9','5e82eed461f76a27430002db','5e82eed461f76a27430002dd','5e82eed461f76a27430002df','5e82eed561f76a27430002f3','5e82eed561f76a27430002e1','5e82eed561f76a27430002e3','5e82eed561f76a27430002e5','5e82eed561f76a2743000301','5e82eed561f76a27430002e7','5e82eed561f76a27430002e9','5e82eed561f76a27430002eb','5e82eed561f76a27430002ed','5e82eed561f76a27430003cd','5e82eed561f76a27430002ef','5e82eed561f76a27430002f7','5e82eed561f76a27430002f9','5e82eed561f76a2743000303','5e82eed561f76a27430003cf','5e82eed561f76a27430002fb','5e82eed561f76a27430002fd','5e82eed561f76a27430002ff','5e82eed561f76a2743000305','5e82eed561f76a2743000309','5e82eed661f76a27430004e7','5e82eed561f76a274300030d','5e82eed561f76a274300030f','5e82eed561f76a2743000317','5e82eed561f76a2743000311','5e82eed561f76a2743000313','5e82eed561f76a2743000315','5e82eed561f76a2743000319','5e82eed561f76a2743000321','5e82eed561f76a27430003ae','5e82eed561f76a274300032b','5e82eed561f76a274300031b','5e82eed561f76a274300031d','5e82eed561f76a274300031f','5e82eed561f76a274300032d','5e82eed561f76a2743000323','5ed4840d61f76a744b052875','5e82eed561f76a2743000327','5e82eed561f76a2743000329','5e82eed561f76a2743000331','5e82eed561f76a2743000333','5e82eed561f76a2743000336','5e82eed561f76a2743000338','5e82eed561f76a274300033a','5e82eed561f76a274300033c','5e82eed561f76a274300033e','5e82eed561f76a2743000340','5e82eed561f76a2743000342','5e82eed561f76a2743000344','5e82eed561f76a2743000346','5e82eed561f76a2743000348','5e82eed561f76a274300034a','5e82eed561f76a274300034c','5e82eed561f76a2743000358','5e82eed561f76a274300034e','5e82eed561f76a2743000350','5e82eed561f76a2743000352','5e82eed561f76a2743000354','5e82eed561f76a2743000356','5e82eed561f76a274300035a','5e82eed561f76a274300035c','5e82eed561f76a274300035e','5e82eed561f76a2743000360','5e82eed561f76a2743000362','5e82eed561f76a2743000364','5e82eed561f76a2743000366','5e82eed561f76a2743000368','5e82eed561f76a274300036a','5e82eed561f76a274300036c','5e82eed561f76a274300036e','5e82eed561f76a2743000370','5e82eed561f76a2743000372','5e82eed561f76a2743000374','5e82eed561f76a2743000376','5e82eed561f76a2743000378','5e82eed561f76a274300037a','5e82eed561f76a274300037c','5e82eed561f76a274300037e','5e82eed561f76a2743000380','5e82eed561f76a2743000382','5e82eed561f76a2743000384','5e82eed561f76a2743000386','5e82eed561f76a2743000390','5e82eed561f76a274300039e','5e82eed561f76a2743000392','5e82eed561f76a2743000394','5e82eed561f76a27430003a0','5e82eed561f76a27430003a2','5e82eed561f76a27430003a4','5e82eed561f76a27430003a6','5e82eed561f76a27430003c0','5e82eed661f76a274300047d','5e82eed561f76a27430003a8','5e82eed561f76a27430003aa','5e82eed561f76a27430003ac','5e82eed561f76a27430003b0','5e82eed561f76a27430003b2','5e82eed561f76a27430003b4','5e82eed561f76a27430003b6','5e82eed561f76a27430003b8','5e82eed561f76a27430003d1','5e82eed561f76a27430003ba','5e82eed561f76a27430003bc','5e82eed561f76a27430003be','5e82eed661f76a27430004ed','5e82eed661f76a274300047f','5e82eed561f76a27430003c2','5e82eed661f76a2743000475','5e82eed561f76a27430003c5','5e82eed561f76a27430003c7','5e82eed561f76a27430003c9','5e82eed561f76a27430003cb','5e82eed561f76a27430003d3','5e82eed561f76a27430003d5','5e82eed561f76a27430003d8','5e82eed561f76a27430003da','5e82eed661f76a27430003e4','5e82eed661f76a27430003e0','5e82eed561f76a27430003dc','5e82eed561f76a27430003de','5e82eed661f76a27430003e2','5e82eed661f76a27430003e8','5e82eed661f76a27430003e6','5e82eed661f76a274300041a','5e82eed661f76a2743000448','5e82eed661f76a27430003ea','5e82eed661f76a27430003ec','5e82eed661f76a27430003ee','5e82eed661f76a27430003f0','5e82eed661f76a2743000491','5e82eed661f76a2743000479','5e82eed661f76a2743000418','5e82eed661f76a27430003f2','5e82eed661f76a27430003f4','5e82eed661f76a27430003f6','5e82eed661f76a2743000404','5e82eed661f76a27430003f8','5e82eed661f76a27430003fa','5e82eed661f76a27430004c3','5e82eed661f76a27430003fc','5e82eed661f76a27430003fe','5e82eed661f76a2743000414','5e82eed661f76a2743000400','5e82eed661f76a2743000402','5e82eed661f76a2743000406','5e82eed661f76a2743000416','5e82eed661f76a274300041c','5e82eed661f76a2743000408','5e82eed661f76a274300040a','5e82eed661f76a27430004c5','5e82eed661f76a274300041e','5e82eed661f76a274300046e','5e82eed661f76a274300040c','5e82eed661f76a274300040e','5e82eed661f76a2743000410','5e82eed661f76a2743000412','5e82eed661f76a2743000420','5e82eed661f76a2743000434','5e82eed661f76a2743000422','5e82eed661f76a2743000424','5e82eed661f76a2743000426','5e82eed661f76a2743000436','5e82eed661f76a2743000428','5e82eed661f76a274300042e','5e82eed661f76a2743000438','5e82eed661f76a274300042a','5e82eed661f76a27430004b7','5e82eed661f76a274300042c','5e82eed661f76a2743000430','5e82eed661f76a27430004c1','5e82eed661f76a274300043e','5e82eed661f76a2743000432','5e82eed661f76a2743000442','5e82eed661f76a274300043a','5e82eed661f76a2743000444','5e82eed661f76a274300043c','5e82eed661f76a2743000446','5e82eed661f76a2743000440','5e82eed661f76a274300044a','5e82eed661f76a274300044c','5e82eed661f76a2743000477','5e82eed661f76a27430004c7','5e82eed661f76a274300044e','5e82eed661f76a2743000450','5e82eed661f76a2743000452','5e82eed661f76a2743000454','5e82eed661f76a2743000456','5e82eed661f76a274300047b','5e82eed661f76a27430004c9','5e82eed661f76a2743000464','5e82eed661f76a2743000458','5e82eed661f76a274300045a','5e82eed661f76a2743000466','5e82eed661f76a274300045c','5e82eed661f76a274300045e','5e82eed661f76a2743000460','5e82eed661f76a2743000462','5e82eed661f76a2743000468','5e82eed661f76a274300046c','5e82eed661f76a274300046a','5e82eed661f76a2743000470','5e82eed661f76a2743000481','5e82eed661f76a2743000483','5e82eed661f76a2743000485','5e82eed661f76a2743000487','5e82eed661f76a2743000489','5e82eed661f76a274300048b','5e82eed661f76a274300048d','5e82eed661f76a274300048f','5e82eed661f76a27430004cb','5e82eed661f76a2743000493','5e82eed661f76a2743000495','5e82eed661f76a2743000497','5e82eed661f76a2743000499','5e82eed661f76a274300049b','5e82eed661f76a274300049d','5e82eed661f76a274300049f','5e82eed661f76a27430004a1','5e82eed661f76a27430004a3','5e82eed661f76a27430004a5','5e82eed661f76a27430004a7','5e82eed661f76a27430004a9','5e82eed661f76a27430004ab','5e82eed661f76a27430004ad','5ed4841561f76a744b052a01','5e82eed661f76a27430004b1','5e82eed661f76a27430004b3','5e82eed661f76a27430004b5','5e82eed661f76a27430004b9','5e82eed661f76a27430004bb','5e82eed661f76a27430004bd','5e82eed661f76a27430004bf','5e82eed661f76a27430004cd','5e82eed661f76a27430004cf','5e82eed661f76a27430004d1','5e82eed661f76a27430004d3','5e82eed661f76a27430004d5','5e82eed661f76a27430004d7','5e82eed661f76a27430004d9','5e82eed661f76a27430004db','5e82eed661f76a27430004dd','5e82eed661f76a27430004df','5e82eed661f76a27430004e1','5e82eed661f76a27430004e3','5e82eed661f76a27430004e5','5e82eed661f76a27430004e9','5e82eed661f76a27430004eb','5e82eed661f76a27430004ef','5e82eed661f76a27430004f1','5e82eed761f76a27430004f3','5e82eed761f76a27430004f5','5e82eed761f76a27430004f7','5e82eed761f76a27430004f9','5e82eed761f76a27430004fb','5e82eed761f76a27430004fd','5e82eed761f76a27430004ff','5ed4841661f76a744b052a54','5e82eed761f76a274300050c','5e82eed761f76a2743000514','5e82eed761f76a274300051f','5e82eed761f76a2743000504','5e82eed761f76a2743000506','5e82eed761f76a274300050e','5e82eed761f76a2743000510','5e82eed761f76a2743000508','5e82eed761f76a274300050a','5e82eed761f76a2743000512','5e82eed761f76a2743000516','5e82eed761f76a2743000519','5e82eed761f76a274300051b','5e82eed761f76a2743000521','5e82eed761f76a2743000523','5e82eed761f76a2743000525','5e82eed761f76a274300051d','5e82eed761f76a2743000527','5e82eed761f76a2743000529','5e82eed761f76a274300052b','5e82eed761f76a274300052d','5e82eed761f76a274300052f','5e82eed761f76a2743000531','5e82eed761f76a2743000533','5e82eed761f76a2743000535','5e82eed761f76a2743000537','5e82eed761f76a2743000539','5e82eed761f76a274300053b','5e82eed761f76a274300053d','5e82eed761f76a274300053f','5e82eed761f76a2743000541','5e82eed761f76a2743000543','5e82eed761f76a2743000545','5e82eed761f76a2743000547','5e82eed761f76a2743000549','5e82eed761f76a274300054b','5e82eed761f76a274300054d','5e82eed761f76a274300054f','5e82eed761f76a2743000551','5e82eed761f76a2743000553','5e82eed761f76a2743000555','5e82eed761f76a2743000557','5e82eed761f76a2743000559','5e82eed761f76a274300055b','5e82eed761f76a274300055d','5e82eed761f76a274300055f','5e82eed761f76a2743000561','5e82eed761f76a2743000563','5e82eed761f76a2743000565','5e82eed761f76a2743000567','5e82eed761f76a2743000569','5e82eed761f76a274300056b','5e82eed761f76a274300056d','5e82eed761f76a274300056f','5e82eed761f76a2743000571','5e82eed761f76a2743000573','5e82eed761f76a2743000575','5e82eed761f76a2743000577','5e82eed761f76a2743000579','5e82eed761f76a274300057b','5e82eed761f76a274300057d','5e82eed761f76a2743000583','5e82eed761f76a2743000581','5e82eed761f76a2743000585','5e82eed761f76a274300058b','5e82eed761f76a274300057f','5e82eed761f76a2743000587','5e82eed761f76a2743000589','5e82eed761f76a274300058d','5e82eed761f76a274300058f','5e82eed761f76a2743000591','5e82eed761f76a2743000593','5e82eed761f76a2743000595','5e82eed761f76a2743000597','5e82eed761f76a2743000599','5e82eed761f76a27430005c5','5e82eed761f76a274300059b','5e82eed761f76a274300059d','5e82eed761f76a274300059f','5e82eed761f76a27430005a1','5e82eed761f76a27430005a3','5e82eed761f76a27430005a5','5e82eed761f76a27430005a7','5e82eed761f76a27430005a9','5e82eed761f76a27430005ab','5e82eed761f76a27430005ad','5e82eed761f76a27430005c7','5e82eed761f76a27430005af','5e82eed761f76a27430005b1','5e82eed761f76a27430005b3','5e82eed761f76a27430005b5','5e82eed761f76a27430005b7','5e82eed761f76a27430005b9','5e82eed761f76a27430005bb','5e82eed761f76a27430005bd','5e82eed761f76a27430005bf','5e82eed761f76a27430005c1','5e82eed761f76a27430005c3','5e82eed761f76a27430005c9','5e82eed761f76a27430005cb','5e82eed761f76a27430005cd','5e82eed761f76a27430005cf','5e82eed761f76a27430005d3','5e82eed761f76a27430005eb','5e82eed761f76a27430005d1','5e82eed761f76a27430005d5','5e82eed761f76a27430005d7','5e82eed761f76a27430005e1','5e82eed761f76a27430005ed','5e82eed761f76a27430005d9','5e82eed761f76a27430005db','5e82eed761f76a27430005e3','5e82eed761f76a27430005e5','5e82eed761f76a27430005e7','5e82eed761f76a27430005dd','5e82eed761f76a27430005df','5e82eed761f76a27430005e9','5e82eed761f76a27430005ef','5e82eed761f76a27430005f1','5e82eed761f76a27430005f3','5e82eed761f76a27430005f5','5e82eed761f76a27430005f7','5e82eed761f76a27430005f9','5e82eed761f76a27430005fb','5e82eed761f76a27430005fd','5e82eed761f76a27430005ff','5e82eed761f76a2743000601','5e82eed761f76a2743000603','5e82eed761f76a2743000605','5e82eed761f76a2743000607','5e82eed761f76a2743000609','5e82eed861f76a274300061a','5e82eed761f76a274300060b','5e82eed761f76a274300060d','5e82eed761f76a274300060f','5e82eed761f76a2743000613','5e82eed861f76a2743000615','5e82eed861f76a274300063a','5e82eed761f76a2743000611','5e82eed861f76a2743000618','5e82eed861f76a274300061c','5e82eed861f76a274300061e','5e82eed861f76a2743000624','5e82eed861f76a2743000620','5e82eed861f76a2743000622','5e82eed861f76a2743000626','5e82eed861f76a2743000628','5e82eed861f76a274300062a','5e82eed861f76a274300062c','5e82eed861f76a274300062e','5e82eed861f76a2743000638','5e82eed861f76a2743000630','5e82eed861f76a2743000632','5e82eed861f76a2743000634','5e82eed861f76a2743000636','5e82eed861f76a274300063c','5e82eed861f76a274300063e','5e82eed861f76a2743000640','5e82eed861f76a2743000642','5e82eed861f76a2743000644','5e82eed861f76a2743000646','5e82eed861f76a2743000648','5e82eed861f76a274300064a','5e82eed861f76a274300064c','5e82eed861f76a274300064e','5e82eed861f76a2743000650','5e82eed861f76a2743000653','5e82eed861f76a2743000655','5e82eed861f76a2743000657','5e82eed861f76a2743000659','5e82eed861f76a274300065b','5e82eed861f76a274300065d','5e82eed861f76a274300065f','5e82eed861f76a2743000661','5e82eed861f76a2743000663','5e82eed861f76a2743000665','5e82eed861f76a2743000667','5e82eed861f76a2743000669','5e82eed861f76a274300066b','5e82eed861f76a274300066d','5e82eed861f76a274300066f','5e82eed861f76a2743000671','5e82eed861f76a2743000673','5e82eed861f76a2743000679','5ed4841d61f76a744b052bd7','5ed4841d61f76a744b052bd9','5e82eed861f76a2743000675')

      AND survey_response.submission_time >= '2017-01-01T00:00:00.000Z'

      AND survey_response.submission_time <= '2021-01-31T23:59:59.999Z'

      ORDER BY survey_response.submission_time;
  `);
  const l = r.rows;
  console.log('took', Date.now() - s, 'size', l.length);
  respond(res, { message: 'success' });
}
