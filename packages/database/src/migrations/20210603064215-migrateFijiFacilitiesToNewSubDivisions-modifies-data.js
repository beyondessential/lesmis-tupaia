'use strict';

var dbm;
var type;
var seed;

/**
 * We receive the dbmigrate dependency from dbmigrate initially.
 * This enables us to not have to rely on NODE_PATH.
 */
exports.setup = function (options, seedLink) {
  dbm = options.dbmigrate;
  type = dbm.dataType;
  seed = seedLink;
};

const facilitiesToMigrate = {
  FJ_138: 'FJ_sdCakaudrove',
  FJ_075: 'FJ_sdBa',
  FJ_077: 'FJ_sdBa',
  FJ_074: 'FJ_sdBa',
  FJ_160: 'FJ_sdLomaiviti',
  FJ_023: 'FJ_sdNausori',
  FJ_013: 'FJ_sdSerua_Namosi',
  FJ_147: 'FJ_sdTaveuni',
  FJ_151: 'FJ_sdBua',
  FJ_068: 'FJ_sdNadi',
  FJ_159: 'FJ_sdLomaiviti',
  FJ_191: 'FJ_sdLakeba',
  FJ_202: 'FJ_sdLomaloma',
  FJ_120: 'FJ_sdMacuata',
  FJ_001: 'FJ_sdSuva',
  FJ_126: 'FJ_sdMacuata',
  FJ_092: 'FJ_sdNadroga',
  FJ_171: 'FJ_sdKadavu',
  FJ_032: 'FJ_sdTailevu',
  FJ_124: 'FJ_sdMacuata',
  FJ_117: 'FJ_sdMacuata',
  FJ_197: 'FJ_sdLakeba',
  FJ_016: 'FJ_sdSerua_Namosi',
  FJ_174: 'FJ_sdKadavu',
  FJ_183: 'FJ_sdLakeba',
  FJ_195: 'FJ_sdLakeba',
  FJ_061: 'FJ_sdLautoka_Yasawa',
  FJ_170: 'FJ_sdKadavu',
  FJ_087: 'FJ_sdNavosa',
  FJ_049: 'FJ_sdLautoka_Yasawa',
  FJ_125: 'FJ_sdMacuata',
  FJ_139: 'FJ_sdCakaudrove',
  FJ_188: 'FJ_sdLakeba',
  FJ_158: 'FJ_sdLomaiviti',
  FJ_088: 'FJ_sdNadroga',
  FJ_135: 'FJ_sdCakaudrove',
  FJ_014: 'FJ_sdSerua_Namosi',
  FJ_028: 'FJ_sdTailevu',
  FJ_225: 'FJ_sdTailevu',
  FJ_027: 'FJ_sdTailevu',
  FJ_154: 'FJ_sdBua',
  FJ_112: 'FJ_sdMacuata',
  FJ_231: 'FJ_sdMacuata',
  FJ_113: 'FJ_sdMacuata',
  FJ_115: 'FJ_sdMacuata',
  FJ_180: 'FJ_sdLakeba',
  FJ_179: 'FJ_sdLomaiviti',
  FJ_007: 'FJ_sdSuva',
  FJ_039: 'FJ_sdNaitasiri',
  FJ_047: 'FJ_sdLautoka_Yasawa',
  FJ_048: 'FJ_sdLautoka_Yasawa',
  FJ_054: 'FJ_sdLautoka_Yasawa',
  FJ_150: 'FJ_sdBua',
  FJ_156: 'FJ_sdLomaiviti',
  FJ_194: 'FJ_sdLakeba',
  FJ_155: 'FJ_sdLakeba',
  FJ_029: 'FJ_sdTailevu',
  FJ_041: 'FJ_sdNaitasiri',
  FJ_201: 'FJ_sdLomaloma',
  FJ_200: 'FJ_sdLomaloma',
  FJ_238: 'FJ_sdNadroga',
  FJ_089: 'FJ_sdNadroga',
  FJ_208: 'FJ_sdSuva',
  FJ_008: 'FJ_sdSuva',
  FJ_050: 'FJ_sdLautoka_Yasawa',
  FJ_182: 'FJ_sdLakeba',
  FJ_181: 'FJ_sdLakeba',
  FJ_189: 'FJ_sdLakeba',
  FJ_022: 'FJ_sdNausori',
  FJ_073: 'FJ_sdNadi',
  FJ_167: 'FJ_sdLomaiviti',
  FJ_203: 'FJ_sdLomaloma',
  FJ_141: 'FJ_sdCakaudrove',
  FJ_165: 'FJ_sdLomaiviti',
  FJ_045: 'FJ_sdNaitasiri',
  FJ_010: 'FJ_sdSuva',
  FJ_210: 'FJ_sdBua',
  FJ_233: 'FJ_sdBua',
  FJ_166: 'FJ_sdLomaiviti',
  FJ_162: 'FJ_sdLomaiviti',
  FJ_051: 'FJ_sdLautoka_Yasawa',
  FJ_082: 'FJ_sdTavua',
  FJ_065: 'FJ_sdNadi',
  FJ_064: 'FJ_sdNadi',
  FJ_084: 'FJ_sdTavua',
  FJ_116: 'FJ_sdMacuata',
  FJ_069: 'FJ_sdNadi',
  FJ_083: 'FJ_sdTavua',
  FJ_076: 'FJ_sdBa',
  FJ_025: 'FJ_sdNausori',
  FJ_161: 'FJ_sdLomaiviti',
  FJ_211: 'FJ_sdNausori',
  FJ_040: 'FJ_sdNaitasiri',
  FJ_136: 'FJ_sdCakaudrove',
  FJ_079: 'FJ_sdBa',
  FJ_177: 'FJ_sdKadavu',
  FJ_067: 'FJ_sdNadi',
  FJ_219: 'FJ_sdNadi',
  FJ_104: 'FJ_sdRa',
  FJ_024: 'FJ_sdNausori',
  FJ_078: 'FJ_sdBa',
  FJ_015: 'FJ_sdSerua_Namosi',
  FJ_196: 'FJ_sdLakeba',
  FJ_070: 'FJ_sdNadi',
  FJ_103: 'FJ_sdRa',
  FJ_038: 'FJ_sdNaitasiri',
  FJ_096: 'FJ_sdNavosa',
  FJ_175: 'FJ_sdKadavu',
  FJ_019: 'FJ_sdSerua_Namosi',
  FJ_128: 'FJ_sdMacuata',
  FJ_163: 'FJ_sdLomaiviti',
  FJ_043: 'FJ_sdNaitasiri',
  FJ_105: 'FJ_sdRa',
  FJ_110: 'FJ_sdRa',
  FJ_119: 'FJ_sdMacuata',
  FJ_190: 'FJ_sdLakeba',
  FJ_046: 'FJ_sdNaitasiri',
  FJ_052: 'FJ_sdLautoka_Yasawa',
  FJ_133: 'FJ_sdCakaudrove',
  FJ_021: 'FJ_sdNausori',
  FJ_071: 'FJ_sdNadi',
  FJ_212: 'FJ_sdNausori',
  FJ_140: 'FJ_sdCakaudrove',
  FJ_153: 'FJ_sdBua',
  FJ_012: 'FJ_sdSerua_Namosi',
  FJ_011: 'FJ_sdSerua_Namosi',
  FJ_018: 'FJ_sdSerua_Namosi',
  FJ_072: 'FJ_sdNadi',
  FJ_164: 'FJ_sdLomaiviti',
  FJ_137: 'FJ_sdCakaudrove',
  FJ_030: 'FJ_sdTailevu',
  FJ_109: 'FJ_sdRa',
  FJ_005: 'FJ_sdSuva',
  FJ_097: 'FJ_sdNavosa',
  FJ_198: 'FJ_sdLakeba',
  FJ_187: 'FJ_sdLakeba',
  FJ_184: 'FJ_sdLakeba',
  FJ_062: 'FJ_sdLautoka_Yasawa',
  FJ_145: 'FJ_sdTaveuni',
  FJ_230: 'FJ_sdLomaiviti',
  FJ_034: 'FJ_sdTailevu',
  FJ_134: 'FJ_sdCakaudrove',
  FJ_090: 'FJ_sdNadroga',
  FJ_003: 'FJ_sdSuva',
  FJ_102: 'FJ_sdRa',
  FJ_100: 'FJ_sdRa',
  FJ_236: 'FJ_sdRa',
  FJ_214: 'FJ_sdSerua_Namosi',
  FJ_172: 'FJ_sdKadavu',
  FJ_033: 'FJ_sdTailevu',
  FJ_206: 'FJ_sdLomaloma',
  FJ_205: 'FJ_sdLomaloma',
  FJ_229: 'FJ_sdSuva',
  FJ_053: 'FJ_sdLautoka_Yasawa',
  FJ_004: 'FJ_sdSuva',
  FJ_132: 'FJ_sdCakaudrove',
  FJ_130: 'FJ_sdCakaudrove',
  FJ_129: 'FJ_sdCakaudrove',
  FJ_118: 'FJ_sdMacuata',
  FJ_086: 'FJ_sdNadroga',
  FJ_085: 'FJ_sdNadroga',
  FJ_060: 'FJ_sdLautoka_Yasawa',
  FJ_173: 'FJ_sdKadavu',
  FJ_226: 'FJ_sdSuva',
  FJ_002: 'FJ_sdSuva',
  FJ_009: 'FJ_sdSuva',
  FJ_178: 'FJ_sdKadavu',
  FJ_099: 'FJ_sdNadroga',
  FJ_081: 'FJ_sdTavua',
  FJ_235: 'FJ_sdTavua',
  FJ_080: 'FJ_sdTavua',
  FJ_127: 'FJ_sdCakaudrove',
  FJ_055: 'FJ_sdLautoka_Yasawa',
  FJ_107: 'FJ_sdRa',
  FJ_035: 'FJ_sdTailevu',
  FJ_192: 'FJ_sdLakeba',
  FJ_131: 'FJ_sdCakaudrove',
  FJ_204: 'FJ_sdLomaloma',
  FJ_098: 'FJ_sdNavosa',
  FJ_123: 'FJ_sdMacuata',
  FJ_176: 'FJ_sdKadavu',
  FJ_006: 'FJ_sdSuva',
  FJ_185: 'FJ_sdLakeba',
  FJ_199: 'FJ_sdLakeba',
  FJ_093: 'FJ_sdNadroga',
  FJ_220: 'FJ_sdTailevu',
  FJ_091: 'FJ_sdNadroga',
  FJ_031: 'FJ_sdTailevu',
  FJ_121: 'FJ_sdMacuata',
  FJ_058: 'FJ_sdLautoka_Yasawa',
  FJ_144: 'FJ_sdTaveuni',
  FJ_146: 'FJ_sdTaveuni',
  FJ_037: 'FJ_sdNaitasiri',
  FJ_036: 'FJ_sdNaitasiri',
  FJ_169: 'FJ_sdKadavu',
  FJ_168: 'FJ_sdKadavu',
  FJ_108: 'FJ_sdRa',
  FJ_122: 'FJ_sdMacuata',
  FJ_042: 'FJ_sdNaitasiri',
  FJ_111: 'FJ_sdRa',
  FJ_222: 'FJ_sdNausori',
  FJ_020: 'FJ_sdNausori',
  FJ_114: 'FJ_sdMacuata',
  FJ_217: 'FJ_sdBua',
  FJ_017: 'FJ_sdSerua_Namosi',
  FJ_143: 'FJ_sdTaveuni',
  FJ_232: 'FJ_sdTaveuni',
  FJ_095: 'FJ_sdNavosa',
  FJ_148: 'FJ_sdTaveuni',
  FJ_152: 'FJ_sdBua',
  FJ_056: 'FJ_sdLautoka_Yasawa',
  FJ_057: 'FJ_sdLautoka_Yasawa',
  FJ_243: 'FJ_sdLautoka_Yasawa',
  FJ_063: 'FJ_sdLautoka_Yasawa',
};

exports.up = async function (db) {
  Object.keys(facilitiesToMigrate).forEach(async facility => {
    const parentId = (
      await db.runSql(`select id from "entity" where code = '${facilitiesToMigrate[facility]}';`)
    ).rows[0].id;

    await db.runSql(`
      update "entity" set parent_id = '${parentId}' where code = '${facility}';
    `);
  });
};

exports.down = function (db) {
  return null;
};

exports._meta = {
  version: 1,
};
