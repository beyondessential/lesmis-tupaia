package main

import (
	"log"
	"time"
)


type Analytic struct {
	SurveyResponseId string	`json:"surveyResponseId"`
	Date time.Time	`json:"date"`
	EntityCode string	`json:"entityCode"`
	EntityName string	`json:"entityName"`
	DataElementCode string	`json:"dataElementCode"`
	ValueType string	`json:"valueType"`
	Value string	`json:"value"`
}

func FetchAnalytics() ([]Analytic, error) {
		db := GetDB()
		query := `
			SELECT
      survey_response_id as "surveyResponseId",
      date,
      entity_code as "entityCode",
      entity_name as "entityName",
      data_element_code as "dataElementCode",
      type,
      value
    FROM
      analytics
    WHERE
      data_element_code IN ('FWV_LGA_003')
    AND
      entity_code IN ('AU_New South Wales_Albury','AU_New South Wales_Inner West','AU_New South Wales_Armidale Regional','AU_New South Wales_Ballina','AU_New South Wales_Canada Bay','AU_New South Wales_Balranald','AU_New South Wales_Bathurst Regional','AU_New South Wales_Blacktown','AU_New South Wales_Campbelltown','AU_New South Wales_Bega Valley','AU_New South Wales_Bellingen','AU_New South Wales_Berrigan','AU_New South Wales_Bland','AU_New South Wales_Blayney','AU_New South Wales_Blue Mountains','AU_New South Wales_Bogan','AU_New South Wales_Bourke','AU_New South Wales_Brewarrina','AU_New South Wales_Broken Hill','AU_New South Wales_Burwood','AU_New South Wales_Byron','AU_New South Wales_Cabonne','AU_New South Wales_Camden','AU_New South Wales_Canterbury-Bankstown','AU_New South Wales_Carrathool','AU_New South Wales_Central Coast','AU_New South Wales_Central Darling','AU_New South Wales_Cessnock','AU_New South Wales_Clarence Valley','AU_New South Wales_Coffs Harbour','AU_New South Wales_Cobar','AU_New South Wales_Woollahra','AU_New South Wales_Coolamon','AU_New South Wales_Coonamble','AU_New South Wales_Cowra','AU_New South Wales_Cumberland','AU_New South Wales_Dungog','AU_New South Wales_Edward River','AU_New South Wales_Eurobodalla','AU_New South Wales_Fairfield','AU_New South Wales_Federation','AU_New South Wales_Forbes','AU_New South Wales_Georges River','AU_New South Wales_Gilgandra','AU_New South Wales_Glen Innes Severn','AU_New South Wales_Goulburn Mulwaree','AU_New South Wales_Greater Hume Shire','AU_New South Wales_Griffith','AU_New South Wales_Cootamundra-Gundagai Regional','AU_New South Wales_Gunnedah','AU_New South Wales_Gwydir','AU_New South Wales_Hawkesbury','AU_New South Wales_Hay','AU_New South Wales_Hunters Hill','AU_New South Wales_Hilltops','AU_New South Wales_Hornsby','AU_New South Wales_Inverell','AU_New South Wales_Maitland','AU_New South Wales_Junee','AU_New South Wales_Kempsey','AU_New South Wales_Kiama','AU_New South Wales_Ku-ring-gai','AU_New South Wales_Kyogle','AU_New South Wales_Lachlan','AU_New South Wales_Shellharbour','AU_New South Wales_Lake Macquarie','AU_New South Wales_Lane Cove','AU_New South Wales_Leeton','AU_New South Wales_Lismore','AU_New South Wales_Lithgow','AU_New South Wales_Liverpool','AU_New South Wales_Liverpool Plains','AU_New South Wales_Lockhart','AU_New South Wales_Mid-Coast','AU_New South Wales_Mid-Western Regional','AU_New South Wales_Moree Plains','AU_New South Wales_Mosman','AU_New South Wales_Murray River','AU_New South Wales_Murrumbidgee','AU_New South Wales_Muswellbrook','AU_New South Wales_Nambucca','AU_New South Wales_Narrabri','AU_New South Wales_Narrandera','AU_New South Wales_Narromine','AU_New South Wales_Newcastle','AU_New South Wales_North Sydney','AU_New South Wales_Northern Beaches','AU_New South Wales_Oberon','AU_New South Wales_Orange','AU_New South Wales_Ryde','AU_New South Wales_Parkes','AU_New South Wales_Parramatta','AU_New South Wales_Penrith','AU_New South Wales_Port Macquarie-Hastings','AU_New South Wales_Port Stephens','AU_New South Wales_Queanbeyan-Palerang Regional','AU_New South Wales_Randwick','AU_New South Wales_Richmond Valley','AU_New South Wales_Shoalhaven','AU_New South Wales_Singleton','AU_New South Wales_Sydney','AU_New South Wales_Temora','AU_New South Wales_Snowy Monaro Regional','AU_New South Wales_Snowy Valleys','AU_New South Wales_Strathfield','AU_New South Wales_Sutherland Shire','AU_New South Wales_Tamworth Regional','AU_New South Wales_Tenterfield','AU_New South Wales_The Hills Shire','AU_New South Wales_Tweed','AU_New South Wales_Upper Hunter Shire','AU_New South Wales_Upper Lachlan Shire','AU_New South Wales_Uralla','AU_New South Wales_Wagga Wagga','AU_New South Wales_Walcha','AU_New South Wales_Walgett','AU_New South Wales_Weddin','AU_New South Wales_Warren','AU_New South Wales_Warrumbungle Shire','AU_New South Wales_Waverley','AU_New South Wales_Wentworth','AU_New South Wales_Dubbo Regional','AU_New South Wales_Willoughby','AU_New South Wales_Wingecarribee','AU_New South Wales_Wollondilly','AU_New South Wales_Wollongong','AU_New South Wales_Yass Valley','AU_New South Wales_Unincorporated','AU_New South Wales_Bayside','AU_Victoria_Maroondah','AU_Victoria_Melbourne','AU_Victoria_Melton','AU_Victoria_Moorabool','AU_Victoria_Moreland','AU_Victoria_Queenscliffe','AU_Victoria_Alpine','AU_Victoria_Ararat','AU_Victoria_Ballarat','AU_Victoria_Banyule','AU_Victoria_Bass Coast','AU_Victoria_Baw Baw','AU_Victoria_Bayside','AU_Victoria_Benalla','AU_Victoria_Boroondara','AU_Victoria_Brimbank','AU_Victoria_Buloke','AU_Victoria_Campaspe','AU_Victoria_Cardinia','AU_Victoria_Casey','AU_Victoria_Central Goldfields','AU_Victoria_Colac-Otway','AU_Victoria_Corangamite','AU_Victoria_Darebin','AU_Victoria_East Gippsland','AU_Victoria_Frankston','AU_Victoria_Gannawarra','AU_Victoria_Glen Eira','AU_Victoria_Glenelg','AU_Victoria_Golden Plains','AU_Victoria_Greater Bendigo','AU_Victoria_Greater Dandenong','AU_Victoria_Greater Geelong','AU_Victoria_Greater Shepparton','AU_Victoria_Hepburn','AU_Victoria_Hindmarsh','AU_Victoria_Hobsons Bay','AU_Victoria_Horsham','AU_Victoria_Hume','AU_Victoria_Indigo','AU_Victoria_Kingston','AU_Victoria_Knox','AU_Victoria_Latrobe','AU_Victoria_Loddon','AU_Victoria_Macedon Ranges','AU_Victoria_Manningham','AU_Victoria_Mansfield','AU_Victoria_Maribyrnong','AU_Victoria_Mildura','AU_Victoria_Mornington Peninsula','AU_Victoria_Mitchell','AU_Victoria_Moira','AU_Victoria_Monash','AU_Victoria_Moonee Valley','AU_Victoria_Mount Alexander','AU_Victoria_Moyne','AU_Victoria_Murrindindi','AU_Victoria_Nillumbik','AU_Victoria_Warrnambool','AU_Victoria_Northern Grampians','AU_Victoria_Port Phillip','AU_Victoria_Pyrenees','AU_Victoria_South Gippsland','AU_Victoria_Southern Grampians','AU_Victoria_Stonnington','AU_Victoria_Strathbogie','AU_Victoria_Surf Coast','AU_Victoria_Swan Hill','AU_Victoria_Towong','AU_Victoria_Wangaratta','AU_Victoria_Wellington','AU_Victoria_West Wimmera','AU_Victoria_Whitehorse','AU_Victoria_Whittlesea','AU_Victoria_Wodonga','AU_Victoria_Wyndham','AU_Victoria_Yarra','AU_Victoria_Yarra Ranges','AU_Victoria_Yarriambiack','AU_Victoria_Unincorporated','AU_Queensland_Yarrabah','AU_Queensland_Aurukun','AU_Queensland_Balonne','AU_Queensland_Boulia','AU_Queensland_Banana','AU_Queensland_Barcoo','AU_Queensland_Barcaldine','AU_Queensland_Blackall-Tambo','AU_Queensland_Bulloo','AU_Queensland_Brisbane','AU_Queensland_Ipswich','AU_Queensland_Bundaberg','AU_Queensland_Burdekin','AU_Queensland_Burke','AU_Queensland_Cairns','AU_Queensland_Hope Vale','AU_Queensland_Carpentaria','AU_Queensland_Cassowary Coast','AU_Queensland_Central Highlands','AU_Queensland_Doomadgee','AU_Queensland_Charters Towers','AU_Queensland_Cherbourg','AU_Queensland_Cloncurry','AU_Queensland_Cook','AU_Queensland_Croydon','AU_Queensland_Diamantina','AU_Queensland_Douglas','AU_Queensland_Etheridge','AU_Queensland_Flinders','AU_Queensland_Fraser Coast','AU_Queensland_Gladstone','AU_Queensland_Gold Coast','AU_Queensland_Goondiwindi','AU_Queensland_Gympie','AU_Queensland_Hinchinbrook','AU_Queensland_Isaac','AU_Queensland_Kowanyama','AU_Queensland_Livingstone','AU_Queensland_Lockhart River','AU_Queensland_Lockyer Valley','AU_Queensland_Logan','AU_Queensland_Longreach','AU_Queensland_Mapoon','AU_Queensland_Mackay','AU_Queensland_McKinlay','AU_Queensland_Moreton Bay','AU_Queensland_Maranoa','AU_Queensland_Mornington','AU_Queensland_Mareeba','AU_Queensland_Mount Isa','AU_Queensland_Murweh','AU_Queensland_Palm Island','AU_Queensland_Napranum','AU_Queensland_Noosa','AU_Queensland_Paroo','AU_Queensland_North Burnett','AU_Queensland_Northern Peninsula Area','AU_Queensland_Pormpuraaw','AU_Queensland_Quilpie','AU_Queensland_Redland','AU_Queensland_Richmond','AU_Queensland_Rockhampton','AU_Queensland_Scenic Rim','AU_Queensland_Somerset','AU_Queensland_South Burnett','AU_Queensland_Townsville','AU_Queensland_Southern Downs','AU_Queensland_Sunshine Coast','AU_Queensland_Weipa','AU_Queensland_Tablelands','AU_Queensland_Toowoomba','AU_Queensland_Torres','AU_Queensland_Torres Strait Island','AU_Queensland_Western Downs','AU_Queensland_Winton','AU_Queensland_Woorabinda','AU_Queensland_Whitsunday','AU_Queensland_Wujal Wujal','AU_South Australia_Unincorporated','AU_South Australia_Adelaide','AU_South Australia_Unley','AU_South Australia_Copper Coast','AU_South Australia_Mitcham','AU_South Australia_Naracoorte and Lucindale','AU_South Australia_Adelaide Hills','AU_South Australia_Alexandrina','AU_South Australia_Anangu Pitjantjatjara','AU_South Australia_Barossa','AU_South Australia_Barunga West','AU_South Australia_Berri and Barmera','AU_South Australia_Burnside','AU_South Australia_Campbelltown','AU_South Australia_Ceduna','AU_South Australia_Charles Sturt','AU_South Australia_Clare and Gilbert Valleys','AU_South Australia_Cleve','AU_South Australia_Coober Pedy','AU_South Australia_Elliston','AU_South Australia_Flinders Ranges','AU_South Australia_Franklin Harbour','AU_South Australia_Gawler','AU_South Australia_Goyder','AU_South Australia_Grant','AU_South Australia_Holdfast Bay','AU_South Australia_Kangaroo Island','AU_South Australia_Karoonda East Murray','AU_South Australia_Kimba','AU_South Australia_Kingston','AU_South Australia_Light','AU_South Australia_Lower Eyre Peninsula','AU_South Australia_Loxton Waikerie','AU_South Australia_Adelaide Plains','AU_South Australia_Maralinga Tjarutja','AU_South Australia_Marion','AU_South Australia_Mid Murray','AU_South Australia_Mount Barker','AU_South Australia_Mount Gambier','AU_South Australia_Mount Remarkable','AU_South Australia_Murray Bridge','AU_South Australia_Northern Areas','AU_South Australia_Norwood Payneham St Peters','AU_South Australia_Onkaparinga','AU_South Australia_Orroroo/Carrieton','AU_South Australia_Peterborough','AU_South Australia_Playford','AU_South Australia_Port Adelaide Enfield','AU_South Australia_Port Augusta','AU_South Australia_Port Lincoln','AU_South Australia_Port Pirie City and Dists','AU_South Australia_Prospect','AU_South Australia_Renmark Paringa','AU_South Australia_Robe','AU_South Australia_Roxby Downs','AU_South Australia_Salisbury','AU_South Australia_Southern Mallee','AU_South Australia_Streaky Bay','AU_South Australia_Tatiara','AU_South Australia_Tea Tree Gully','AU_South Australia_The Coorong','AU_South Australia_Tumby Bay','AU_South Australia_Victor Harbor','AU_South Australia_Wakefield','AU_South Australia_Walkerville','AU_South Australia_Wattle Range','AU_South Australia_West Torrens','AU_South Australia_Whyalla','AU_South Australia_Wudinna','AU_South Australia_Yankalilla','AU_South Australia_Yorke Peninsula','AU_South Australia_Unincorporate','AU_Western Australia_Bassendean','AU_Western Australia_Albany','AU_Western Australia_Armadale','AU_Western Australia_Bayswater','AU_Western Australia_Belmont','AU_Western Australia_Ashburton','AU_Western Australia_Augusta-Margaret River','AU_Western Australia_Beverley','AU_Western Australia_Boddington','AU_Western Australia_Boyup Brook','AU_Western Australia_Bridgetown-Greenbushes','AU_Western Australia_Brookton','AU_Western Australia_Bruce Rock','AU_Western Australia_Bunbury','AU_Western Australia_Busselton','AU_Western Australia_Broome','AU_Western Australia_Broomehill-Tambellup','AU_Western Australia_Cambridge','AU_Western Australia_Canning','AU_Western Australia_Capel','AU_Western Australia_Carnamah','AU_Western Australia_Carnarvon','AU_Western Australia_Chapman Valley','AU_Western Australia_Chittering','AU_Western Australia_Claremont','AU_Western Australia_Cockburn','AU_Western Australia_Collie','AU_Western Australia_Coolgardie','AU_Western Australia_Coorow','AU_Western Australia_Corrigin','AU_Western Australia_Cottesloe','AU_Western Australia_Cranbrook','AU_Western Australia_Cuballing','AU_Western Australia_Cue','AU_Western Australia_Cunderdin','AU_Western Australia_Dalwallinu','AU_Western Australia_Dandaragan','AU_Western Australia_Dardanup','AU_Western Australia_Denmark','AU_Western Australia_Derby-West Kimberley','AU_Western Australia_Donnybrook-Balingup','AU_Western Australia_Dowerin','AU_Western Australia_Dumbleyung','AU_Western Australia_Dundas','AU_Western Australia_East Fremantle','AU_Western Australia_East Pilbara','AU_Western Australia_Esperance','AU_Western Australia_Exmouth','AU_Western Australia_Fremantle','AU_Western Australia_Gingin','AU_Western Australia_Gnowangerup','AU_Western Australia_Goomalling','AU_Western Australia_Gosnells','AU_Western Australia_Greater Geraldton','AU_Western Australia_Halls Creek','AU_Western Australia_Harvey','AU_Western Australia_Irwin','AU_Western Australia_Jerramungup','AU_Western Australia_Joondalup','AU_Western Australia_Kalamunda','AU_Western Australia_Kalgoorlie/Boulder','AU_Western Australia_Kellerberrin','AU_Western Australia_Kent','AU_Western Australia_Koorda','AU_Western Australia_Karratha','AU_Western Australia_Katanning','AU_Western Australia_Kojonup','AU_Western Australia_Kondinin','AU_Western Australia_Kulin','AU_Western Australia_Kwinana','AU_Western Australia_Lake Grace','AU_Western Australia_Laverton','AU_Western Australia_Leonora','AU_Western Australia_Mandurah','AU_Western Australia_Manjimup','AU_Western Australia_Meekatharra','AU_Western Australia_Melville','AU_Western Australia_Menzies','AU_Western Australia_Merredin','AU_Western Australia_Mingenew','AU_Western Australia_Moora','AU_Western Australia_Morawa','AU_Western Australia_Mosman Park','AU_Western Australia_Mount Magnet','AU_Western Australia_Mount Marshall','AU_Western Australia_Mukinbudin','AU_Western Australia_Mundaring','AU_Western Australia_Murchison','AU_Western Australia_Murray','AU_Western Australia_Nannup','AU_Western Australia_Narembeen','AU_Western Australia_Narrogin','AU_Western Australia_Nedlands','AU_Western Australia_Ngaanyatjarraku','AU_Western Australia_Northam','AU_Western Australia_Northampton','AU_Western Australia_Nungarin','AU_Western Australia_Peppermint Grove','AU_Western Australia_Perenjori','AU_Western Australia_Perth','AU_Western Australia_Pingelly','AU_Western Australia_Plantagenet','AU_Western Australia_Quairading','AU_Western Australia_Port Hedland','AU_Western Australia_Ravensthorpe','AU_Western Australia_Rockingham','AU_Western Australia_Stirling','AU_Western Australia_Sandstone','AU_Western Australia_Serpentine-Jarrahdale','AU_Western Australia_Subiaco','AU_Western Australia_Swan','AU_Western Australia_Tammin','AU_Western Australia_Shark Bay','AU_Western Australia_South Perth','AU_Western Australia_Three Springs','AU_Western Australia_Toodyay','AU_Western Australia_Trayning','AU_Western Australia_Upper Gascoyne','AU_Western Australia_Victoria Park','AU_Western Australia_Victoria Plains','AU_Western Australia_Vincent','AU_Western Australia_Wagin','AU_Western Australia_Wandering','AU_Western Australia_Wanneroo','AU_Western Australia_Waroona','AU_Western Australia_West Arthur','AU_Western Australia_Westonia','AU_Western Australia_Wickepin','AU_Western Australia_Williams','AU_Western Australia_Wiluna','AU_Western Australia_Wongan-Ballidu','AU_Western Australia_Woodanilling','AU_Western Australia_Wyalkatchem','AU_Western Australia_Wyndham-East Kimberley','AU_Western Australia_Yilgarn','AU_Western Australia_Yalgoo','AU_Western Australia_York','AU_Western Australia_Unincorporated','AU_Tasmania_Brighton','AU_Tasmania_Break O''Day','AU_Tasmania_Burnie','AU_Tasmania_Central Coast','AU_Tasmania_Clarence','AU_Tasmania_Central Highlands','AU_Tasmania_Circular Head','AU_Tasmania_Derwent Valley','AU_Tasmania_Devonport','AU_Tasmania_Dorset','AU_Tasmania_Flinders','AU_Tasmania_George Town','AU_Tasmania_Glamorgan/Spring Bay','AU_Tasmania_Glenorchy','AU_Tasmania_Hobart','AU_Tasmania_Huon Valley','AU_Tasmania_Kentish','AU_Tasmania_King Island','AU_Tasmania_Kingborough','AU_Tasmania_Latrobe','AU_Tasmania_Launceston','AU_Tasmania_Meander Valley','AU_Tasmania_Northern Midlands','AU_Tasmania_Sorell','AU_Tasmania_Southern Midlands','AU_Tasmania_Tasman','AU_Tasmania_Waratah/Wynyard','AU_Tasmania_West Coast','AU_Tasmania_West Tamar','AU_Northern Territory_Alice Springs','AU_Northern Territory_Barkly','AU_Northern Territory_Belyuen','AU_Northern Territory_Central Desert','AU_Northern Territory_Coomalie','AU_Northern Territory_Darwin','AU_Northern Territory_East Arnhem','AU_Northern Territory_Katherine','AU_Northern Territory_Litchfield','AU_Northern Territory_MacDonnell','AU_Northern Territory_Palmerston','AU_Northern Territory_Roper Gulf','AU_Northern Territory_Tiwi Islands','AU_Northern Territory_Victoria Daly','AU_Northern Territory_Wagait','AU_Northern Territory_West Arnhem','AU_Northern Territory_West Daly','AU_Northern Territory_Unincorporated','AU_Australian Capital Territory_Unincorporated')

      AND date >= '2017-01-01T00:00:00.000Z'

      AND date <= '2021-01-31T23:59:59.999Z'

      ORDER BY date;
		`

		s := time.Now();
		rows, err := db.Query(query)
		if err != nil {
            log.Fatal(err)
        }
		defer rows.Close()

    var analytics []Analytic
    for rows.Next() {
			analytic := Analytic{}
        err := rows.Scan(&analytic.SurveyResponseId, &analytic.Date,&analytic.EntityCode, &analytic.EntityName, &analytic.DataElementCode, &analytic.ValueType, &analytic.Value)
        if err != nil {
            log.Fatal(err)
        }

        analytics = append(analytics, analytic)
		}

		t := time.Now().Sub(s).Milliseconds()
		log.Printf("time now %d, r length %d", t, len(analytics))
    return analytics, nil
}
