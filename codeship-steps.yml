- name: Validate and test
  type: parallel
  exclude: -e2e$
  steps:
    - type: parallel
      name: Validate
      service: validation
      steps:
        - name: Validate branch name
          command: './packages/devops/scripts/ci/validateBranchName.sh'
        - name: Validate tests
          command: './packages/devops/scripts/ci/validateTests.sh'
    - name: Test
      # Because we need to set up the database, and our service linking to the db using depends_on re-creates the
      # container for each step, we have to set up and test in a single step.
      command: './packages/devops/scripts/ci/test.sh'

- name: Deploy changes
  service: deployment
  command: './triggerRedeploy.sh'

- name: E2E test
  type: parallel
  service: e2e
  tag: -e2e$
  steps:
    - name: E2E test web-frontend
      command: './packages/devops/scripts/ci/testE2e.sh web-frontend'
